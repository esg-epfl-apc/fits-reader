!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.FITSReader=e():t.FITSReader=e()}(this,(()=>(()=>{"use strict";var t={d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,o(n.key),n)}}function o(t){var e=function(t,e){if("object"!=r(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,"string");if("object"!=r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==r(e)?e:e+""}t.r(e),t.d(e,{parseFITS:()=>dt});var i=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.cardIndex=0,this.primary=e,this.extension=!1,this.extensionType=null},(e=[{key:"verifyOrder",value:function(t,e){e!==this.cardIndex&&console.warn("".concat(t," should appear at index ").concat(this.cardIndex," in the FITS header"))}},{key:"verifyBetween",value:function(t,e,r,n){if(!(e>=r&&e<=n))throw"The ".concat(t," value of ").concat(e," is not between ").concat(r," and ").concat(n)}},{key:"verifyBoolean",value:function(t){return"T"===t}},{key:"SIMPLE",value:function(t){return this.primary=!0,this.verifyOrder("SIMPLE",0),this.verifyBoolean(t)}},{key:"XTENSION",value:function(t){return this.extension=!0,this.extensionType=t,this.verifyOrder("XTENSION",0),this.extensionType}},{key:"BITPIX",value:function(t){var e="BITPIX";if(t=parseInt(t),this.verifyOrder(e,1),![8,16,32,-32,-64].includes(t))throw"".concat(e," value ").concat(t," is not permitted");return t}},{key:"NAXIS",value:function(t,e){var r="NAXIS";if(t=parseInt(t),!e&&(this.verifyOrder(r,2),this.verifyBetween(r,t,0,999),this.extension&&["TABLE","BINTABLE"].includes(this.extensionType))&&2!==t)throw"".concat(r," must be ").concat(2," for TABLE and BINTABLE extensions");return t}},{key:"PCOUNT",value:function(t){var e="PCOUNT";t=parseInt(t);var r=3+this.NAXIS();if(this.verifyOrder(e,r),this.extension&&["IMAGE","TABLE"].includes(this.extensionType)&&0!==t)throw"".concat(e," must be ").concat(0," for the ").concat(this.extensionType," extensions");return t}},{key:"GCOUNT",value:function(t){var e="GCOUNT";t=parseInt(t);var r=3+this.NAXIS()+1;if(this.verifyOrder(e,r),this.extension&&["IMAGE","TABLE","BINTABLE"].includes(this.extensionType)&&1!==t)throw"".concat(e," must be ").concat(1," for the ").concat(this.extensionType," extensions");return t}},{key:"EXTEND",value:function(t,e){if(!e)throw"EXTEND must only appear in the primary header";return this.verifyBoolean(t)}},{key:"BSCALE",value:function(t){return parseFloat(t)}},{key:"BZERO",value:function(t){return parseFloat(t)}},{key:"BLANK",value:function(t){return t=parseInt(t),this.get("BITPIX")>0||console.warn("BLANK is not to be used for BITPIX = ".concat(this.get("BITPIX"))),t}},{key:"DATAMIN",value:function(t){return parseFloat(t)}},{key:"DATAMAX",value:function(t){return parseFloat(t)}},{key:"EXTVER",value:function(t){return parseInt(t)}},{key:"EXTLEVEL",value:function(t){return parseInt(t)}},{key:"TFIELDS",value:function(t){return t=parseInt(t),this.verifyBetween("TFIELDS",t,0,999),t}},{key:"TBCOL",value:function(t,e){return t=parseInt(t),this.verifyBetween("TBCOL",e,0,this.get("TFIELDS")),t}},{key:"ZIMAGE",value:function(t){return this.verifyBoolean(t)}},{key:"ZCMPTYPE",value:function(t){if(!["GZIP_1","RICE_1","PLIO_1","HCOMPRESS_1"].includes(t))throw"ZCMPTYPE value ".concat(t," is not permitted");if("RICE_1"!==t)throw"Compress type ".concat(t," is not yet implement");return t}},{key:"ZBITPIX",value:function(t){if(t=parseInt(t),![8,16,32,64,-32,-64].includes(t))throw"ZBITPIX value ".concat(t," is not permitted");return t}},{key:"ZNAXIS",value:function(t,e){return t=parseInt(t),e||this.verifyBetween("ZNAXIS",t,0,999),t}},{key:"ZTILE",value:function(t){return parseInt(t)}},{key:"ZSIMPLE",value:function(t){return"T"===t}},{key:"ZPCOUNT",value:function(t){return parseInt(t)}},{key:"ZGCOUNT",value:function(t){return parseInt(t)}},{key:"ZDITHER0",value:function(t){return parseInt(t)}}])&&n(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function u(t){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u(t)}function a(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,u,a=[],s=!0,f=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=i.call(r)).done)&&(a.push(n.value),a.length!==e);s=!0);}catch(t){f=!0,o=t}finally{try{if(!s&&null!=r.return&&(u=r.return(),Object(u)!==u))return}finally{if(f)throw o}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return s(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function f(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,l(n.key),n)}}function c(t,e,r){return(e=l(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function l(t){var e=function(t,e){if("object"!=u(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=u(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==u(e)?e:e+""}var y=function(){return t=function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),c(this,"arrayPattern",/(\D+)(\d+)/),c(this,"maxLines",600),this.headerVerify=r,this.supportedCards=null,this.primary=r.primary,this.extension=!this.primary,null!=r){var n=Object.getOwnPropertyNames(Object.getPrototypeOf(this.headerVerify));this.supportedCards=n.filter((function(t){return"function"==typeof r[t]}))}this.cards={},this.cards.COMMENT=[],this.cards.HISTORY=[],this.cardIndex=0,this.block=e,this.readBlock(e)},(e=[{key:"get",value:function(t){return this.contains(t)?this.cards[t].value:null}},{key:"set",value:function(t,e,r){return r=r||"",this.cards[t]={index:this.cardIndex,value:e,comment:r},this.cardIndex+=1}},{key:"contains",value:function(t){return this.cards.hasOwnProperty(t)}},{key:"readLine",value:function(t){var e,r,n,o;if(""!==(n=t.slice(0,8).trim())){if(r=t.slice(8,10),o=t.slice(10),"= "===r){var i=a(o.split(" /"),2);return o=i[0],e=i[1],"'"===(o=o.trim())[0]?o=o.slice(1,-1).trim():"T"!==o&&"F"!==o&&(o=parseFloat(o)),o=this.validate(n,o),this.set(n,o,e)}"COMMENT"!==n&&"HISTORY"!==n||this.cards[n].push(o.trim())}}},{key:"validate",value:function(t,e){var r,n,o;if(n=null,r=t,o=this.arrayPattern.test(t)){var i=a(this.arrayPattern.exec(t).slice(1),2);r=i[0],n=i[1]}return r in this.supportedCards&&(e=this.headerVerify[r](e,o,n)),e}},{key:"readBlock",value:function(t){var e,r,n,o,i,u;for(u=[],e=r=0,i=(o=(o=t.length/80)<this.maxLines?o:this.maxLines)-1;0<=i?r<=i:r>=i;e=0<=i?++r:--r)n=t.slice(80*e,80*(e+1)),u.push(this.readLine(n));return u}},{key:"hasDataUnit",value:function(){return 0!==this.get("NAXIS")}},{key:"getDataLength",value:function(){var t,e,r,n;if(!this.hasDataUnit())return 0;for(r=[],t=e=1,n=this.get("NAXIS");1<=n?e<=n:e>=n;t=1<=n?++e:--e)r.push(this.get("NAXIS".concat(t)));return r.reduce((function(t,e){return t*e}))*Math.abs(this.get("BITPIX"))/8+this.get("PCOUNT")}},{key:"getDataType",value:function(){switch(this.extensionType||(this.extensionType=null),this.cards.XTENSION&&(this.extensionType=this.cards.XTENSION.value),this.extensionType){case"BINTABLE":return this.contains("ZIMAGE")?"CompressedImage":"BinaryTable";case"TABLE":return"Table";default:return this.hasDataUnit()?"Image":null}}},{key:"isPrimary",value:function(){return this.primary}},{key:"isExtension",value:function(){return this.extension}}])&&f(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function h(t){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h(t)}function p(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,b(n.key),n)}}function b(t){var e=function(t,e){if("object"!=h(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=h(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==h(e)?e:e+""}var v=function(){return t=function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.header=e,this.data=r},(e=[{key:"hasData",value:function(){return null!=this.data}}])&&p(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function m(t){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},m(t)}function d(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,g(n.key),n)}}function g(t){var e=function(t,e){if("object"!=m(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=m(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==m(e)?e:e+""}function w(t){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},w(t)}function S(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,B(n.key),n)}}function T(t,e,r){return e=E(e),function(t,e){if(e&&("object"===w(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,O()?Reflect.construct(e,r||[],E(t).constructor):e.apply(t,r))}function O(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(O=function(){return!!t})()}function E(t){return E=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},E(t)}function I(t,e){return I=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},I(t,e)}function B(t){var e=function(t,e){if("object"!=w(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=w(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==w(e)?e:e+""}var P,k,A,j=function(t){function e(t,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),n=T(this,e),e.initializeSwapEndian(),r instanceof ArrayBuffer?n.buffer=r:n.blob=r,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&I(t,e)}(e,t),r=e,n=[{key:"initializeSwapEndian",value:function(){e.swapEndian[8]=e.swapEndian.B,e.swapEndian[16]=e.swapEndian.I,e.swapEndian[32]=e.swapEndian.J}}],null&&S(r.prototype,null),n&&S(r,n),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n}(function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},(e=[{key:"invoke",value:function(t,e,r){var n;if(n=null!=(null!=e?e.context:void 0)?e.context:this,null!=t)return t.call(n,r,e)}}])&&d(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}());function N(t){return N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},N(t)}function L(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,U(n.key),n)}}function C(t,e,r){return e=x(e),function(t,e){if(e&&("object"===N(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,D()?Reflect.construct(e,r||[],x(t).constructor):e.apply(t,r))}function D(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(D=function(){return!!t})()}function x(t){return x=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},x(t)}function F(t,e){return F=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},F(t,e)}function U(t){var e=function(t,e){if("object"!=N(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=N(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==N(e)?e:e+""}P=j,A={B:function(t){return t},I:function(t){return t<<8|t>>8},J:function(t){return(255&t)<<24|(65280&t)<<8|t>>8&65280|t>>24&255}},(k=B(k="swapEndian"))in P?Object.defineProperty(P,k,{value:A,enumerable:!0,configurable:!0,writable:!0}):P[k]=A;var _=function(t){function e(t,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e,r){(e=U(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r}(n=C(this,e,[t,r]),"maxMemory",1048576),n.rowByteSize=t.get("NAXIS1"),n.rows=t.get("NAXIS2"),n.cols=t.get("TFIELDS"),n.length=n.rowByteSize*n.rows,n.heapLength=t.get("PCOUNT"),n.columns=n.getColumns(t),null!=n.buffer?(n.rowsInMemory=n._rowsInMemoryBuffer,n.heap=n.buffer.slice(n.length,n.length+n.heapLength)):(n.rowsInMemory=n._rowsInMemoryBlob,n.firstRowInBuffer=n.lastRowInBuffer=0,n.nRowsInBuffer=Math.floor(n.maxMemory/n.rowByteSize)),n.accessors=[],n.descriptors=[],n.elementByteLengths=[],n.setAccessors(t),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&F(t,e)}(e,t),r=e,n=[{key:"_rowsInMemoryBuffer",value:function(){return!0}},{key:"_rowsInMemoryBlob",value:function(t,e){return!(t<this.firstRowInBuffer||e>this.lastRowInBuffer)}},{key:"getColumns",value:function(t){var e,r,n,o,i;for(e=[],r=n=1,i=this.cols;1<=i?n<=i:n>=i;r=1<=i?++n:--n){if(o="TTYPE".concat(r),!t.contains(o))return null;e.push(t.get(o))}return e}},{key:"getColumn",value:function(t,e,r){var n,o,i,u,a,s,f,c,l,y,h=this;return null!=this.blob?(c=this.columns.indexOf(t),u=this.descriptors[c],n=this.accessors[c],this.elementByteLengths[c],a=0===(a=this.elementByteLengths.slice(0,c)).length?0:a.reduce((function(t,e){return t+e})),i=null!=this.typedArray[u]?new this.typedArray[u](this.rows):[],y=~~(this.maxMemory/this.rowByteSize),y=Math.min(y,this.rows),s=this.rows/y,l=Math.floor(s)===s?s:Math.floor(s)+1,f=0,c=0,o=function(t,r){var u,s,p,b;for(u=t.byteLength/h.rowByteSize,b=new DataView(t),s=a;u--;)i[f]=n(b,s)[0],f+=1,s+=h.rowByteSize;if(c+=1,l-=1)return p=c*y,h.getTableBuffer(p,y,o,r);h.invoke(e,r,i)},this.getTableBuffer(0,y,o,r)):(o=function(r,n){return i=r.map((function(e){return e[t]})),h.invoke(e,n,i)},this.getRows(0,this.rows,o,r))}},{key:"getTableBuffer",value:function(t,e,r,n){var o,i,u,a,s=this;return e=Math.min(this.rows-t,e),u=(o=t*this.rowByteSize)+e*this.rowByteSize,i=this.blob.slice(o,u),(a=new FileReader).row=t,a.number=e,a.onloadend=function(t){return s.invoke(r,n,t.target.result)},a.readAsArrayBuffer(i)}},{key:"getRows",value:function(t,e,r,n){var o,i,u,a,s,f,c=this;return this.rowsInMemory(t,t+e)?(null!=this.blob?u=this.buffer:(a=(o=t*this.rowByteSize)+e*this.rowByteSize,u=this.buffer.slice(o,a)),f=this._getRows(u,e),this.invoke(r,n,f),f):(a=(o=t*this.rowByteSize)+Math.max(this.nRowsInBuffer*this.rowByteSize,e*this.rowByteSize),i=this.blob.slice(o,a),(s=new FileReader).row=t,s.number=e,s.onloadend=function(o){var i;return i=o.target,c.buffer=i.result,c.firstRowInBuffer=c.lastRowInBuffer=i.row,c.lastRowInBuffer+=i.number,c.getRows(t,e,r,n)},s.readAsArrayBuffer(i))}}],n&&L(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n}(j);function M(t){return M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},M(t)}function R(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Z(n.key),n)}}function H(t,e,r){return e=z(e),function(t,e){if(e&&("object"===M(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,X()?Reflect.construct(e,r||[],z(t).constructor):e.apply(t,r))}function X(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(X=function(){return!!t})()}function z(t){return z=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},z(t)}function G(t,e){return G=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},G(t,e)}function Z(t){var e=function(t,e){if("object"!=M(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=M(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==M(e)?e:e+""}var K=function(t){function e(){var t;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return function(t,e,r){(e=Z(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r}(t=H(this,e,[].concat(n)),"dataAccessors",{A:function(t){return t.trim()},I:function(t){return parseInt(t)},F:function(t){return parseFloat(t)},E:function(t){return parseFloat(t)},D:function(t){return parseFloat(t)}}),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&G(t,e)}(e,t),r=e,n=[{key:"setAccessors",value:function(t){var e,r,n,o,i,u,a,s=this;for(i=/([AIFED])(\d+)\.*(\d+)*/,a=[],n=o=1,u=this.cols;1<=u?o<=u:o>=u;n=1<=u?++o:--o)r=t.get("TFORM".concat(n)),t.get("TTYPE".concat(n)),e=i.exec(r)[1],a.push(function(t){var e;return e=function(e){return s.dataAccessors[t](e)},s.accessors.push(e)}(e));return a}},{key:"_getRows",value:function(t){var e,r,n,o,i,u,a,s,f,c,l,y,h,p,b,v,m,d,g;for(y=t.byteLength/this.rowByteSize,r=new Uint8Array(t),m=[],i=a=0,p=y-1;0<=p?a<=p:a>=p;i=0<=p?++a:--a){for(o=(n=i*this.rowByteSize)+this.rowByteSize,c="",l=0,s=(d=r.subarray(n,o)).length;l<s;l++)g=d[l],c+=String.fromCharCode(g);for(c=c.trim().split(/\s+/),v={},u=h=0,f=(b=this.accessors).length;h<f;u=++h)e=b[u],g=c[u],v[this.columns[u]]=e(g);m.push(v)}return m}}],n&&R(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n}(_);function Y(t){return Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Y(t)}function V(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,u,a=[],s=!0,f=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=i.call(r)).done)&&(a.push(n.value),a.length!==e);s=!0);}catch(t){f=!0,o=t}finally{try{if(!s&&null!=r.return&&(u=r.return(),Object(u)!==u))return}finally{if(f)throw o}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return J(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?J(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function J(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function W(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,rt(n.key),n)}}function $(t,e,r){return e=q(e),function(t,e){if(e&&("object"===Y(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Q()?Reflect.construct(e,r||[],q(t).constructor):e.apply(t,r))}function Q(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Q=function(){return!!t})()}function q(t){return q=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},q(t)}function tt(t,e){return tt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tt(t,e)}function et(t,e,r){return(e=rt(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function rt(t){var e=function(t,e){if("object"!=Y(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Y(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Y(e)?e:e+""}var nt=function(t){function e(){var t;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return et(t=$(this,e,[].concat(n)),"typedArray",{B:Uint8Array,I:Uint16Array,J:Uint32Array,E:Float32Array,D:Float64Array,1:Uint8Array,2:Uint16Array,4:Uint32Array}),et(t,"dataAccessors",{L:function(t,e){return[84===t.getInt8(e),e+=1]},B:function(t,e){return[t.getUint8(e),e+=1]},I:function(t,e){return[t.getInt16(e),e+=2]},J:function(t,e){return[t.getInt32(e),e+=4]},K:function(t,e){var r,n;return r=Math.abs(t.getInt32(e)),e+=4,[((n=r%10)?-1:1)*((r-=n)<<32|Math.abs(t.getInt32(e))),e+=4]},A:function(t,e){var r;return r=t.getUint8(e),[r=String.fromCharCode(r),e+=1]},E:function(t,e){return[t.getFloat32(e),e+=4]},D:function(t,e){return[t.getFloat64(e),e+=8]},C:function(t,e){var r;return r=t.getFloat32(e),e+=4,[[r,t.getFloat32(e)],e+=4]},M:function(t,e){var r;return r=t.getFloat64(e),e+=8,[[r,t.getFloat64(e)],e+=8]}}),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tt(t,e)}(e,t),r=e,n=[{key:"toBits",value:function(t){var e,r;for(e=[],r=128;r>=1;)e.push(t&r?1:0),r/=2;return e}},{key:"getFromHeap",value:function(t,e,r){var n,o,i;return i=t.getInt32(e),e+=4,n=t.getInt32(e),e+=4,o=this.heap.slice(n,n+i),[new this.typedArray[r](o),e]}},{key:"setAccessors",value:function(t){var r,n,o,i,u,a,s,f,c,l,y,h=this;for(f=/(\d*)([P|Q]*)([L|X|B|I|J|K|A|E|D|C|M]{1})/,l=[],i=a=1,c=this.cols;1<=c?a<=c:a>=c;i=1<=c?++a:--a)o=t.get("TFORM".concat(i)),y=t.get("TTYPE".concat(i)),s=f.exec(o),r=parseInt(s[1])||1,u=s[2],n=s[3],l.push(function(t,r){var n,o;if(h.descriptors.push(t),h.elementByteLengths.push(e.offsets[t]*r),u)switch(y){case"COMPRESSED_DATA":n=function(e,r){var n,o,i=V(h.getFromHeap(e,r,t),2);return n=i[0],r=i[1],o=new h.typedArray[h.algorithmParameters.BYTEPIX](h.ztile[0]),Decompress.Rice(n,h.algorithmParameters.BLOCKSIZE,h.algorithmParameters.BYTEPIX,o,h.ztile[0],Decompress.RiceSetup),[o,r]};break;case"GZIP_COMPRESSED_DATA":n=function(t,e){var r;for(r=new Float32Array(h.width),i=r.length;i--;)r[i]=NaN;return[r,e]};break;default:n=function(e,r){return h.getFromHeap(e,r,t)}}else 1===r?n=function(e,r){var n=V(h.dataAccessors[t](e,r),2);return[n[0],r=n[1]]}:"X"===t?(o=Math.log(r)/Math.log(2),n=function(t,e){var n,i,u,a,s,f,c;for(u=t.buffer.slice(e,e+o),i=[],c=0,f=(s=new Uint8Array(u)).length;c<f;c++)a=s[c],n=h.toBits(a),i=i.concat(n);return e+=o,[i.slice(0,+(r-1)+1||9e9),e]}):n="A"===t?function(t,e){var n,o,i,u,a,s;for(o=t.buffer.slice(e,e+r),a="",u=0,i=(n=new Uint8Array(o)).length;u<i;u++)s=n[u],a+=String.fromCharCode(s);return[a=a.trim(),e+=r]}:function(e,n){var o,u;for(i=r,o=[];i--;){var a=V(h.dataAccessors[t](e,n),2);u=a[0],n=a[1],o.push(u)}return[o,n]};return h.accessors.push(n)}(n,r));return l}},{key:"_getRows",value:function(t,e){var r,n,o,i,u,a,s,f,c;for(c=new DataView(t),i=0,s=[];e--;){for(a={},r=n=0,o=(u=this.accessors).length;n<o;r=++n){var l=V((0,u[r])(c,i),2);f=l[0],i=l[1],a[this.columns[r]]=f}s.push(a)}return s}}],n&&W(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n}(_);function ot(t){return ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ot(t)}function it(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,at(n.key),n)}}function ut(t,e,r){return(e=at(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function at(t){var e=function(t,e){if("object"!=ot(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=ot(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ot(e)?e:e+""}et(nt,"offsets",{L:1,B:1,I:2,J:4,K:8,A:1,E:4,D:8,C:8,M:16});var st=function(){return t=function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),ut(this,"LINEWIDTH",80),ut(this,"BLOCKLENGTH",2880),ut(this,"hdus",[]),this.arrayBuffer=e,this.fitsFile=r,this.file=null,this.length=null,this.primary=!0,this.blockCount=0,this.begin=0,this.end=this.BLOCKLENGTH,this.offset=0,this.headerStorage=new Uint8Array},e=[{key:"parseFileFromBuffer",value:function(){var t;if(this.file=this.arrayBuffer,this.length=this.file.byteLength,t=this.file.slice(this.begin+this.offset,this.end+this.offset),this.readBlock(t))return this.fitsFile;throw new Error("Error parsing the file")}},{key:"readFromBuffer",value:function(){var t;return t=this.file.slice(this.begin+this.offset,this.end+this.offset),this.readBlock(t)}},{key:"readFromFile",value:function(){var t,e=this;return this.reader=new FileReader,this.reader.onloadend=function(t){return e.readBlock(t.target.result)},t=this.file.slice(this.begin+this.offset,this.end+this.offset),this.reader.readAsArrayBuffer(t)}},{key:"readBlock",value:function(t){var e,r,n,o,u,a,s,f,c,l,h,p,b;for(e=new Uint8Array(t),p=new Uint8Array(this.headerStorage),this.headerStorage=new Uint8Array(this.end),this.headerStorage.set(p,0),this.headerStorage.set(e,this.begin),c=this.BLOCKLENGTH/this.LINEWIDTH;c--;)if(32!==e[f=c*this.LINEWIDTH]){if(69===e[f]&&78===e[f+1]&&68===e[f+2]&&32===e[f+3]){for(l="",u=0,a=(s=this.headerStorage).length;u<a;u++)b=s[u],l+=String.fromCharCode(b);return o=new y(l,new i(this.primary)),!0===this.primary&&(this.primary=!1),this.start=this.end+this.offset,r=o.getDataLength(),h=this.file.slice(this.start,this.start+r),o.hasDataUnit()&&(n=this.createDataUnit(o,h)),this.hdus.push(new v(o,n)),this.fitsFile.addHDU(new v(o,n)),this.offset+=this.end+r+this.excessBytes(r),this.offset===this.length?(this.headerStorage=null,!0):(this.blockCount=0,this.begin=this.blockCount*this.BLOCKLENGTH,this.end=this.begin+this.BLOCKLENGTH,this.headerStorage=new Uint8Array,t=this.file.slice(this.begin+this.offset,this.end+this.offset),this.readBlock(t))}break}return this.blockCount+=1,this.begin=this.blockCount*this.BLOCKLENGTH,this.end=this.begin+this.BLOCKLENGTH,t=this.file.slice(this.begin+this.offset,this.end+this.offset),this.readBlock(t)}},{key:"_readBlockFromBuffer",value:function(t){return this.readBlock(t)}},{key:"_readBlockFromFile",value:function(t){return this.reader.readAsArrayBuffer(t)}},{key:"createDataUnit",value:function(t,e){var r=null;switch(t.getDataType()){case"BinaryTable":r=new nt(t,e);break;case"Table":r=new K(t,e);break;default:r=new Image(t,e)}return r}},{key:"excessBytes",value:function(t){return(this.BLOCKLENGTH-t%this.BLOCKLENGTH)%this.BLOCKLENGTH}},{key:"isEOF",value:function(){return this.offset===this.length}}],e&&it(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function ft(t){return ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ft(t)}function ct(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,lt(n.key),n)}}function lt(t){var e=function(t,e){if("object"!=ft(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=ft(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ft(e)?e:e+""}var yt=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),function(t,e,r){(e=lt(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r}(this,"hdus",[])},e=[{key:"addHDU",value:function(t){this.hdus.push(t)}},{key:"getHDU",value:function(t){return t>=0&&t<this.file.hdus.length?this.hdus[t]:null}},{key:"getHDUs",value:function(){var t,e,r=[],n="";return this.hdus.forEach((function(o,i){!0===o.header.primary?e="PRIMARY":(e=o.header.get("XTENSION"),n=o.header.get("EXTNAME")),t={name:e,index:i,extname:n},r.push(t)})),r}},{key:"getTabularHDUs",value:function(){var t=[];return this.hdus.forEach((function(e,r){!0!==e.header.primary&&("TABLE"!==e.header.get("XTENSION")&&"BINTABLE"!==e.header.get("XTENSION")||t.push(r))})),t}},{key:"getNumberOfColumnFromHDU",value:function(t){var e=this.getHDU(t),r=e.header,n=e.data,o=r.get("XTENSION");return"BINTABLE"!==o&&"TABLE"!==o?null:n.cols}},{key:"getColumnsNameFromHDU",value:function(t){var e,r=this.getHDU(t),n=r.header,o=r.data,i=n.get("XTENSION"),u=[];return"BINTABLE"!==i&&"TABLE"!==i?null:(o.columns.forEach((function(t){e=t,u.push(e)})),u)}},{key:"getColumnsJSONDataFromHDU",value:function(t){var e,r=this.getHDU(t),n=r.header,o=r.data,i=n.get("XTENSION"),u=[],a=[];if("BINTABLE"!==i&&"TABLE"!==i)return null;o.columns.forEach((function(t){try{o.getColumn(t,(function(t){e=t})),a[t]=e}catch(t){}}));for(var s=Object.keys(a),f=function(t){var e={};s.forEach((function(r){e[r]=a[r][t]})),u.push(e)},c=0;c<a[s[0]].length;c++)f(c);return u}},{key:"getColumnDataFromHDU",value:function(t,e){var r=this.getHDU(t),n=r.header,o=r.data,i=n.get("XTENSION"),u=[];return"BINTABLE"!==i&&"TABLE"!==i?null:(o.getColumn(e,(function(t){if(void 0===t[0]){var n=r.header.get(e);t=t.map((function(){return n}))}u=t})),u)}},{key:"getHeaderFromHDU",value:function(t){return this.getHDU(t).header}},{key:"getDataFromHDU",value:function(t){return this.getHDU(t).data}},{key:"getHeaderCardValueByNameFromHDU",value:function(t,e){var r=this.getHDU(t).header.get(e);return void 0===r&&(r=""),r}},{key:"getHeaderCardsValueFromHDU",value:function(t){var e=this.getHDU(t),r=[];return Object.entries(e.header.cards).forEach((function(t){var e=t[1];"object"!==ft(e)||Array.isArray(e)||(e.card_name=t[0],r.push(e))})),r.sort((function(t,e){return t.index-e.index}))}},{key:"isHDUTabular",value:function(t){var e=!1,r=this.getHDU(t).header.get("XTENSION");return"BINTABLE"!==r&&"TABLE"!==r||(e=!0),e}}],e&&ct(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function ht(t){return ht="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ht(t)}function pt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,vt(n.key),n)}}function bt(t,e,r){return(e=vt(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function vt(t){var e=function(t,e){if("object"!=ht(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=ht(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ht(e)?e:e+""}var mt=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),bt(this,"array_buffer",null),bt(this,"parser",null),this.array_buffer=e,this.parser=new st(e,new yt)},(e=[{key:"parseFile",value:function(){return this.parser.parseFileFromBuffer(this.array_buffer)}}])&&pt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function dt(t){return new mt(t).parseFile()}return e})()));